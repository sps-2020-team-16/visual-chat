<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Chat Box</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/chatroom_style.css">  
</head>

<body>
  <nav class="navbar navbar-default navbar-static-top" role="navigation">
    <div class="container-fluid"> 
      <div class="navbar-header">
          <a class="navbar-brand" href="#">Visual Chat</a>
      </div>
      <div>
          <ul class="nav navbar-nav">
              <li class="active"><a href="#">David</a></li>
              <li><a href="#">Sign Out</a></li>
          </ul>
      </div>
    </div>
  </nav>

  <h2>Chat Box</h2>
  <div id="avatar1">
    <img class="avatar" src="imgs/3.jpg" alt="">
    <span class="name">Cathy</span>
  </div>
  <div id="avatar2">
    <img class="avatar" src="imgs/4.jpg" alt="">
    <span class="name">Ron</span>
  </div>
  <div id="avatar3">
    <img class="avatar" src="imgs/3.jpg" alt="">
    <span class="name">Julia</span>
  </div>
  <div id="avatar4">
    <img class="avatar" src="imgs/4.jpg" alt="">
    <span class="name">David</span>
  </div>
  <div class="chat-container">
    <ul class="chat">
      <li class="message left">
        <img class="logo" src="imgs/17.jpg" alt="">
        <p>I'm hungry!</p>
        <div class="name">
          Cathy
        </div>
      </li>
      <li class="message right">
        <img class="logo" src="imgs/67.jpg" alt="">
        <p>Hi hungry, nice to meet you. I'm Dad.</p>
        <div class="name">
          David
        </div>
      </li>
      <li class="message left">
        <img class="logo" src="imgs/17.jpg" alt="">
        <p>DAD! I'm serious!</p>
        <div class="name">
          Cathy
        </div>
      </li>
      <li class="message right">
        <img class="logo" src="imgs/67.jpg" alt="">
        <p>I thought your name was hungry...?</p>
        <div class="name">
          David
        </div>
      </li>
    </ul>
  </div>
  <div class="col-lg-6">
    <div class="input-group">
      <input type="text" class="form-control" placeholder="Message...">
      <span class="input-group-btn">
        <button class="btn btn-default" type="button">
          Send
        </button>
      </span>
    </div><!-- /input-group -->
  </div><!-- /.col-lg-6 -->

  <!-- ######################################### -->
  <!-- Changes Start -->
  <!-- ######################################### -->

  <script src="https://avatar-dot-rqian-sps-summer20.df.r.appspot.com/Samples/TypeScript/iframe/avatar.js"></script>

  <script>

    // Step 1.
    AVATAR.iframeDomain = 'https://avatar-dot-rqian-sps-summer20.df.r.appspot.com/'

    // Step 2.
    avatarA = new AVATAR(
        'https://avatar-dot-rqian-sps-summer20.df.r.appspot.com/Samples/TypeScript/avatar/',        //  Remote Avatar
        // '../CubismSdkForWeb-4-r.1/Samples/TypeScript/avatar/',                                   //  Local Avatar
        500,        // width of the new div
        500,        // height of the new div
        1000,       // width of the canvas (increase this to make the model larger)
        500,        // height of the canvas
        0,          // offset in x direction
        0,          // offset in y direction
        {
            "avatar": 'Mark',        // the name of the avatar 2D model
            "gearandback": "false",     // if true the switching gear the background will appear
            "buttons": "false"          // skip the render of buttons
        }           // additional arguments to be sent to the avatar service
    )
    avatarA.renderIn( window.document.getElementById('avatar1') )

    // Step 3. The model has been renderred. However, the div 'avatar1' is too small and the 2D avatar is outside of the div range.
    // So it is needed to modify the avatar's position and size.
    // These settings can make the avatar in the center of the div 'avatar1'

    aADiv = avatarA.getContainerDiv()
    aADiv.style.left    = 'calc(50% - 250px)'
    aADiv.style.top     = 'calc(50% - 250px)'

    // step 4. Currently, the avatar div is still clipped by the 'avatar1' div, and the chat bubble can not be seen.

    // Uncomment this line to make the chat bubble not clipped
    ///////////////////////////////////////////////////////////////////////////
    // window.document.getElementById('avatar1').style.overflow = 'visible'
    ///////////////////////////////////////////////////////////////////////////

    // give a relatively high z-index so the avatar won't be covered by other divs/imgs
    aADiv.style['z-index'] = 50
    setTimeout( ()=>{ avatarA.say( 'hello' , 3000 ) } , 2000 )

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    // Step 1~4 will render a quite big canvas if you use F12 to check the size.
    // And It will sharply degrade performance if redundant canvas regions are renderred
    // Much memory will be used to render redundant canvas regions, and the browser will become laggy/slow


    // step 5. I think it is better to set the avatar div's size and canvas size equal to the formmer div's size ('avatar3') .
    // I think the code below is a better way to render the avatar.


    // width3 = width of div 'avatar3'
    // height3 = height of div 'avatar3'
    const width3  = 120
    const height3 = 200

    avatarC = new AVATAR(
        'https://avatar-dot-rqian-sps-summer20.df.r.appspot.com/Samples/TypeScript/avatar/',        //  Remote Avatar
        // '../CubismSdkForWeb-4-r.1/Samples/TypeScript/avatar/',                                   //  Local Avatar
        width3,        // width of the new div
        height3,        // height of the new div
        width3,       // width of the canvas (increase this to make the model larger)
        height3,        // height of the canvas
        0,          // offset in x direction
        0,          // offset in y direction
        {
            "avatar": 'Haru',           // the name of the avatar 2D model
            "gearandback": "false",     // if true the switching gear the background will appear
            "buttons": "false",         // skip the render of buttons

                                        ////////////////////////////////////////////////////////////////////////////
            "matrixHeight": 15.0,        //  Use these 2 arguments to fine resize and reposition the avatar model
            "matrixY":      -5.0        //  This seems cumbersome, but the performance can be obviously improved.
                                        ////////////////////////////////////////////////////////////////////////////

        }           // additional arguments to be sent to the avatar service
    )
    avatarC.getContainerDiv().style.left = '0px'
    avatarC.getContainerDiv().style.top = '0px'
    avatarC.getContainerDiv().style['z-index'] = 50

    // Set target div's overflow to visible
    window.document.getElementById('avatar3').style.overflow = 'visible'
    // moveTo is similar as renderIn
    avatarC.moveTo('avatar3')

    //For debugging with F12
    window.avatarC = avatarC

    setTimeout( ()=>{ avatarC.setExpression( 'expression:f01' , true ) } , 6000 )

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    //step 6, same way to render avatarD without setting window.avatarD=avatarD

    const width4  = 120
    const height4 = 200

    avatarD = new AVATAR(
        'https://avatar-dot-rqian-sps-summer20.df.r.appspot.com/Samples/TypeScript/avatar/',        //  Remote Avatar
        // '../CubismSdkForWeb-4-r.1/Samples/TypeScript/avatar/',                                   //  Local Avatar
        width4,        // width of the new div
        height4,        // height of the new div
        width4,       // width of the canvas (increase this to make the model larger)
        height4,        // height of the canvas
        0,          // offset in x direction
        0,          // offset in y direction
        {
            "avatar": 'Hiyori',           // the name of the avatar 2D model
            "gearandback": "false",     // if true the switching gear the background will appear
            "buttons": "false",         // skip the render of buttons

                                        ////////////////////////////////////////////////////////////////////////////
            "matrixHeight": 15.0,        //  Use these 2 arguments to fine resize and reposition the avatar model
            "matrixY":      -4.5        //  This seems cumbersome, but the performance can be obviously improved.
                                        ////////////////////////////////////////////////////////////////////////////

        }           // additional arguments to be sent to the avatar service
    )
    
    avatarD.getContainerDiv().style.left = '0px'
    avatarD.getContainerDiv().style.top = '0px'
    avatarD.getContainerDiv().style['z-index'] = 50

    window.document.getElementById('avatar4').style.overflow = 'visible'
    avatarD.moveTo('avatar4')

    window.avatarD = avatarD
    setTimeout( ()=>{ avatarD.say( 'hello' , 3000 ) } , 5000 )
    setTimeout( ()=>{ avatarD.setMotion( 'motion:Idle:5' , true ) } , 7000 )




  </script>

  <!-- ######################################### -->
  <!-- Changes End -->
  <!-- ######################################### -->

</body>

</html>
